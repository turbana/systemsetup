- name: checkout emacs repo
  git:
    repo: git://git.savannah.gnu.org/emacs.git
    dest: ~/apps/src/emacs
    depth: 1
    version: emacs-26.3


- name: build emacs - autogen.sh
  command: >-
    sh autogen.sh
    chdir=~/apps/src/emacs
    creates=~/apps/src/emacs/configure

- name: build emacs - configure
  command: >-
    ./configure --prefix=$HOME/apps --with-x-toolkit=yes
    chdir=~/apps/src/emacs
    creates=~/apps/src/emacs/Makefile

- name: build emacs - make
  command: >-
    make
    chdir=~/apps/src/emacs
    creates=~/apps/src/emacs/src/emacs

- name: build emacs - make install
  command: >-
    make install
    chdir=~/apps/src/emacs
    creates=~/apps/bin/emacs


- name: checkout spacemacs repo
  git:
    repo: https://github.com/syl20bnr/spacemacs
    dest: ~/.emacs.d


- name: update emacs packages
  command: ~/apps/bin/emacs --batch -l ~/.emacs.d/init.el --eval='(progn (configuration-layer/update-packages t) (server-force-delete))'


- name: checkout all-the-icons repo
  git:
    repo: https://github.com/domtronn/all-the-icons.el.git
    dest: ~/apps/src/all-the-icons

- name: copy all-the-icons fonts
  copy:
    remote_src: yes
    src: ~/apps/src/all-the-icons/fonts/
    dest: ~/.fonts/
  notify: reload fc-cache
