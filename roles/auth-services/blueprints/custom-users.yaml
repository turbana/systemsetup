version: 1
metadata:
  name: Custom User/Group Setup - {{ site_name }}
entries:

  ####################################################
  ### Groups
  ####################################################
    
{% for group in authentik.groups %}
  ## Group
  - id: group-{{ group | lower | replace(' ', '-') }}
    identifiers:
      attributes:
        blueprint-id: group-{{ group | lower | replace(' ', '-') }}
    model: authentik_core.group
    attrs:
      name: {{ group }}
      attributes: {}
    conditions: []
    permissions: []
    state: present
    
  ## Group Policy
{% endfor %}


  ####################################################
  ### Users
  ####################################################

# {% for user in secret_authentik_users %}
#   - id: user-{{ user.username | lower | replace('@', '-') | replace('.', '-') }}
#     identifiers:
#       attributes:
#         blueprint-id: user-{{ user.username | lower | replace('@', '-') | replace('.', '-') }}
#     model: authentik_core.user
#     attrs:
#       name: {{ user.name }}
#       username: {{ user.username }}
#       email: {{ user.username }}
#       type: internal
#       is_active: true
#       # path: goauthentik.io/sources/google
#       # path: users/provisioned
#       # attributes:
#       #   goauthentik.io/user/sources:
#       #     - Google
#       groups:
# {% for group in user.groups %}
#         - !Find [authentik_core.group, [name, {{ group }}]]
# {% endfor %}
#     conditions: []
#     permissions: []
#     state: present
# {% endfor %}
