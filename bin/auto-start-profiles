#!/usr/bin/env bash
if [ $# -eq 0 ]; then
    echo "usage: $(basename $0) profile1 [profile2 profile3 ...]"
    echo "will mark specific guix profiles to auto start"
    echo "they will then be sourced from ~/.profile"
    exit 2
fi

GUIX_PROFILES=~/.config/guix/profiles
GUIX_AUTO_PROFILES=~/.config/guix/auto-start-profiles
failed=0

for name in $*; do
    profile="${GUIX_PROFILES}/${name}/${name}"
    if [ -d "$profile" ]; then
        echo "* enabling auto-start for profile $name"
        mkdir -p $GUIX_AUTO_PROFILES
        ln -sf $profile ${GUIX_AUTO_PROFILES}/
        [ "$?" -eq "0" ] || failed=1
    else
        echo "* could not locate profile $name"
        failed=1
    fi
done

exit $failed
